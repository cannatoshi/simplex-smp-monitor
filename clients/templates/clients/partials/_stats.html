<!-- Stats Cards - 4 Karten mit 4-Ecken + Mitte Layout -->
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4" id="stats-cards">
    
    <!-- STATUS Card -->
    <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 h-36 flex flex-col relative">
        <!-- Top Row -->
        <div class="flex justify-between text-xs text-slate-400 mb-auto">
            <span title="WebSocket Port">Port <span class="text-slate-200">{{ client.websocket_port }}</span></span>
            <span id="stat-uptime" class="px-1.5 py-0.5 rounded {% if client.status == 'running' %}bg-cyan-900/30 text-cyan-400{% else %}bg-slate-800 text-slate-500{% endif %}">
                {% if client.status == 'running' %}{{ client.uptime_display|default:"0s" }}{% else %}--{% endif %}
            </span>
        </div>
        
        <!-- Center -->
        <div class="flex items-center justify-center gap-2 my-auto">
            {% if client.status == 'running' %}
            <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
            </span>
            <span class="text-2xl font-bold text-emerald-400">Läuft</span>
            {% elif client.status == 'error' %}
            <span class="h-3 w-3 rounded-full bg-red-500"></span>
            <span class="text-2xl font-bold text-red-500">Fehler</span>
            {% elif client.status == 'starting' or client.status == 'stopping' %}
            <span class="h-3 w-3 rounded-full bg-amber-500 animate-pulse"></span>
            <span class="text-2xl font-bold text-amber-500">{{ client.get_status_display }}</span>
            {% else %}
            <span class="h-3 w-3 rounded-full bg-slate-500"></span>
            <span class="text-2xl font-bold text-slate-500">Gestoppt</span>
            {% endif %}
        </div>
        <p class="text-xs text-slate-500 text-center -mt-1">Status</p>
        
        <!-- Bottom Row -->
        <div class="flex justify-between text-xs text-slate-400 mt-auto">
            <span title="Verbindungen"><span id="stat-connections" class="text-slate-200">{{ connections|length }}</span> Verb.</span>
            <span title="Profil">{{ client.profile_name }}</span>
        </div>
    </div>

    <!-- NACHRICHTEN Card (Gesendet + Empfangen kombiniert) -->
    <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 h-36 flex flex-col relative">
        <!-- Top Row -->
        <div class="flex justify-between text-xs text-slate-400 mb-auto">
            <span title="Zugestellt">✓ <span id="stat-delivered" class="text-emerald-400">{{ client.messages_delivered|default:0 }}</span></span>
            <span title="Fehlgeschlagen">✗ <span id="stat-failed" class="text-red-400">{{ client.messages_failed|default:0 }}</span></span>
        </div>
        
        <!-- Center -->
        <div class="flex items-center justify-center gap-6 my-auto">
            <div class="text-center">
                <p class="text-2xl font-bold text-emerald-400" id="stat-sent">{{ client.messages_sent }}</p>
                <p class="text-xs text-slate-500">↑ Gesendet</p>
            </div>
            <div class="w-px h-8 bg-slate-700"></div>
            <div class="text-center">
                <p class="text-2xl font-bold text-cyan-400" id="stat-received">{{ client.messages_received }}</p>
                <p class="text-xs text-slate-500">↓ Empfangen</p>
            </div>
        </div>
        
        <!-- Bottom Row -->
        <div class="flex justify-between text-xs text-slate-400 mt-auto">
            <span title="Ausstehend">⏳ <span id="stat-pending" class="text-amber-400">0</span></span>
            <span title="Letzte Nachricht" id="stat-last-message">{% if client.last_message_received %}{{ client.last_message_received|timesince }}{% else %}--{% endif %}</span>
        </div>
    </div>

    <!-- ERFOLGSRATE Card -->
    <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 h-36 flex flex-col relative">
        <!-- Top Row -->
        <div class="flex justify-between text-xs text-slate-400 mb-auto">
            <span title="Heute gesendet">Heute: <span class="text-slate-200">{{ client.messages_sent }}</span></span>
            <span title="Gesamt">Gesamt: <span class="text-slate-200">{{ client.messages_sent }}</span></span>
        </div>
        
        <!-- Center -->
        <div class="flex flex-col items-center justify-center my-auto">
            {% with rate=client.delivery_success_rate %}
            <p class="text-3xl font-bold {% if rate >= 90 %}text-emerald-400{% elif rate >= 70 %}text-amber-400{% else %}text-red-400{% endif %}" id="stat-success-rate">
                {{ rate|floatformat:1 }}%
            </p>
            <p class="text-xs text-slate-500">Erfolgsrate</p>
            {% endwith %}
        </div>
        
        <!-- Bottom Row: Progress Bar -->
        <div class="mt-auto">
            <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                {% with rate=client.delivery_success_rate %}
                <div id="stat-success-bar" class="h-full rounded-full transition-all duration-500 {% if rate >= 90 %}bg-emerald-500{% elif rate >= 70 %}bg-amber-500{% else %}bg-red-500{% endif %}"
                     style="width: {{ rate }}%"></div>
                {% endwith %}
            </div>
            <div class="flex justify-between text-xs text-slate-500 mt-1">
                <span>0%</span>
                <span>100%</span>
            </div>
        </div>
    </div>

    <!-- LATENZ Card -->
    <div class="bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 p-4 h-36 flex flex-col relative">
        <!-- Top Row -->
        <div class="flex justify-between text-xs mb-auto">
            <span class="text-emerald-400" title="Minimale Latenz">↓ <span id="stat-latency-min">{{ client.min_latency_ms|default:"-" }}</span>{% if client.min_latency_ms %}ms{% endif %}</span>
            <span class="text-red-400" title="Maximale Latenz">↑ <span id="stat-latency-max">{{ client.max_latency_ms|default:"-" }}</span>{% if client.max_latency_ms %}ms{% endif %}</span>
        </div>
        
        <!-- Center -->
        <div class="flex flex-col items-center justify-center my-auto">
            <p class="text-3xl font-bold text-white" id="stat-latency-avg">
                {% if client.avg_latency_ms %}{{ client.avg_latency_ms|floatformat:0 }}<span class="text-lg text-slate-400">ms</span>{% else %}-{% endif %}
            </p>
            <p class="text-xs text-slate-500">Ø Latenz</p>
        </div>
        
        <!-- Bottom Row: Mini Sparkline -->
        <div class="mt-auto">
            <div class="h-6 flex items-end gap-0.5" id="latency-sparkline">
                {% for i in "123456789012345" %}
                <div class="flex-1 bg-slate-700 rounded-t transition-all duration-300" style="height: 20%;"></div>
                {% endfor %}
            </div>
            <div class="flex justify-between text-xs text-slate-500 mt-1">
                <span>Letzte 15</span>
                <span id="stat-latency-trend">--</span>
            </div>
        </div>
    </div>
</div>