# Generated by Django 6.0 on 2026-01-10 20:42

import django.core.validators
import django.db.models.deletion
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='TorNetwork',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Eindeutiger Name für dieses Tor-Netzwerk', max_length=100, unique=True)),
                ('slug', models.SlugField(blank=True, help_text='URL-freundlicher Name (auto-generiert)', max_length=100, unique=True)),
                ('description', models.TextField(blank=True, help_text='Beschreibung und Zweck dieses Netzwerks')),
                ('template', models.CharField(choices=[('minimal', 'Minimal (3 DA, 2 Relay, 1 Exit, 1 Client)'), ('basic', 'Basic (3 DA, 4 Relay, 2 Exit, 2 Client)'), ('standard', 'Standard (3 DA, 6 Relay, 3 Exit, 3 Client)'), ('forensic', 'Forensic (3 DA, 8 Relay, 4 Exit, 4 Client, Full Capture)'), ('custom', 'Custom Configuration')], default='basic', help_text='Netzwerk-Topologie Template', max_length=20)),
                ('num_directory_authorities', models.PositiveIntegerField(default=3, help_text='Anzahl Directory Authorities (min. 3 für Konsens)', validators=[django.core.validators.MinValueValidator(3), django.core.validators.MaxValueValidator(9)])),
                ('num_guard_relays', models.PositiveIntegerField(default=2, help_text='Anzahl Guard Relays', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(20)])),
                ('num_middle_relays', models.PositiveIntegerField(default=2, help_text='Anzahl Middle Relays', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(20)])),
                ('num_exit_relays', models.PositiveIntegerField(default=2, help_text='Anzahl Exit Relays', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)])),
                ('num_clients', models.PositiveIntegerField(default=2, help_text='Anzahl Tor Clients (SOCKS Proxies)', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(20)])),
                ('num_hidden_services', models.PositiveIntegerField(default=0, help_text='Anzahl Hidden Service Nodes', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)])),
                ('docker_network_name', models.CharField(blank=True, help_text='Docker Netzwerk Name (auto-generiert)', max_length=100)),
                ('container_prefix', models.CharField(blank=True, help_text='Präfix für Container-Namen (auto-generiert)', max_length=50)),
                ('base_control_port', models.IntegerField(default=8000, help_text='Basis-Port für Tor Control Ports (8000, 8001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('base_socks_port', models.IntegerField(default=9000, help_text='Basis-Port für SOCKS Proxies (9000, 9001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('base_or_port', models.IntegerField(default=5000, help_text='Basis-Port für Onion Router Ports (5000, 5001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('base_dir_port', models.IntegerField(default=7000, help_text='Basis-Port für Directory Ports (7000, 7001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('testing_tor_network', models.BooleanField(default=True, help_text='TestingTorNetwork 1 - Beschleunigt Bootstrap')),
                ('voting_interval', models.IntegerField(default=20, help_text='V3AuthVotingInterval in Sekunden (schneller = schnellerer Bootstrap)', validators=[django.core.validators.MinValueValidator(10), django.core.validators.MaxValueValidator(300)])),
                ('assume_reachable', models.BooleanField(default=True, help_text='AssumeReachable 1 - Überspringt Erreichbarkeitstests')),
                ('capture_enabled', models.BooleanField(default=True, help_text='Traffic Capture auf allen Nodes aktivieren')),
                ('capture_filter', models.CharField(blank=True, default='tcp port 5000-5100 or tcp port 9000-9100', help_text='tcpdump Filter Expression', max_length=200)),
                ('max_capture_size_mb', models.IntegerField(default=100, help_text='Maximale Capture-Größe pro Node in MB', validators=[django.core.validators.MinValueValidator(10), django.core.validators.MaxValueValidator(10000)])),
                ('capture_rotate_interval', models.IntegerField(default=3600, help_text='Capture-Rotation Intervall in Sekunden', validators=[django.core.validators.MinValueValidator(60), django.core.validators.MaxValueValidator(86400)])),
                ('status', models.CharField(choices=[('not_created', 'Not Created'), ('creating', 'Creating...'), ('bootstrapping', 'Bootstrapping...'), ('running', 'Running'), ('stopping', 'Stopping...'), ('stopped', 'Stopped'), ('error', 'Error')], default='not_created', max_length=20)),
                ('status_message', models.TextField(blank=True, help_text='Detaillierte Status-Nachricht oder Fehler')),
                ('bootstrap_progress', models.IntegerField(default=0, help_text='Bootstrap-Fortschritt in Prozent', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('consensus_valid', models.BooleanField(default=False, help_text='Gültiger Konsens vorhanden')),
                ('consensus_valid_after', models.DateTimeField(blank=True, help_text='Konsens gültig ab', null=True)),
                ('consensus_fresh_until', models.DateTimeField(blank=True, help_text='Konsens frisch bis', null=True)),
                ('consensus_valid_until', models.DateTimeField(blank=True, help_text='Konsens gültig bis', null=True)),
                ('total_circuits_created', models.PositiveIntegerField(default=0)),
                ('total_bytes_transferred', models.BigIntegerField(default=0)),
                ('total_cells_processed', models.BigIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('stopped_at', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'Tor Network',
                'verbose_name_plural': 'Tor Networks',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TorNode',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Node-Name (z.B. da1, guard1, exit2)', max_length=100)),
                ('node_type', models.CharField(choices=[('da', 'Directory Authority'), ('guard', 'Guard Relay'), ('middle', 'Middle Relay'), ('exit', 'Exit Relay'), ('client', 'Client (SOCKS Proxy)'), ('hs', 'Hidden Service')], help_text='Typ des Tor-Knotens', max_length=10)),
                ('index', models.PositiveIntegerField(default=0, help_text='Index innerhalb des Typs (0, 1, 2, ...)')),
                ('container_id', models.CharField(blank=True, help_text='Docker Container ID', max_length=64)),
                ('container_name', models.CharField(blank=True, help_text='Docker Container Name', max_length=100)),
                ('control_port', models.IntegerField(blank=True, help_text='Tor Control Port', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('socks_port', models.IntegerField(blank=True, help_text='SOCKS5 Proxy Port (nur für Clients)', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('or_port', models.IntegerField(blank=True, help_text='Onion Router Port', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('dir_port', models.IntegerField(blank=True, help_text='Directory Port (nur für DAs)', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('fingerprint', models.CharField(blank=True, help_text='Relay Fingerprint (40 hex chars)', max_length=50)),
                ('v3_identity', models.CharField(blank=True, help_text='V3 Authority Identity (nur für DAs)', max_length=50)),
                ('nickname', models.CharField(blank=True, help_text='Tor Relay Nickname', max_length=50)),
                ('onion_address', models.CharField(blank=True, help_text='.onion Adresse (nur für Hidden Services)', max_length=62)),
                ('hs_port', models.IntegerField(blank=True, help_text='Hidden Service virtueller Port', null=True)),
                ('hs_target_port', models.IntegerField(blank=True, help_text='Hidden Service Target Port (localhost)', null=True)),
                ('flags', models.JSONField(blank=True, default=list, help_text='Relay Flags aus dem Konsens')),
                ('status', models.CharField(choices=[('not_created', 'Not Created'), ('created', 'Created'), ('starting', 'Starting...'), ('bootstrapping', 'Bootstrapping...'), ('running', 'Running'), ('stopping', 'Stopping...'), ('stopped', 'Stopped'), ('error', 'Error')], default='not_created', max_length=20)),
                ('status_message', models.TextField(blank=True, help_text='Detaillierte Status-Nachricht')),
                ('bootstrap_progress', models.IntegerField(default=0, help_text='Bootstrap-Fortschritt in Prozent', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('capture_enabled', models.BooleanField(default=True, help_text='Traffic Capture für diesen Node aktiviert')),
                ('capture_interface', models.CharField(default='eth0', help_text='Netzwerk-Interface für Capture', max_length=20)),
                ('capture_file_path', models.CharField(blank=True, help_text='Pfad zur aktuellen Capture-Datei', max_length=255)),
                ('bytes_read', models.BigIntegerField(default=0, help_text='Empfangene Bytes')),
                ('bytes_written', models.BigIntegerField(default=0, help_text='Gesendete Bytes')),
                ('circuits_created', models.PositiveIntegerField(default=0, help_text='Erstellte Circuits')),
                ('circuits_active', models.PositiveIntegerField(default=0, help_text='Aktive Circuits')),
                ('bandwidth_rate', models.BigIntegerField(default=0, help_text='Aktuelle Bandbreite (Bytes/s)')),
                ('bandwidth_burst', models.BigIntegerField(default=0, help_text='Burst Bandbreite (Bytes/s)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('last_seen', models.DateTimeField(blank=True, null=True)),
                ('network', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='nodes', to='chutney.tornetwork')),
            ],
            options={
                'verbose_name': 'Tor Node',
                'verbose_name_plural': 'Tor Nodes',
                'ordering': ['network', 'node_type', 'index'],
                'unique_together': {('network', 'name')},
            },
        ),
        migrations.CreateModel(
            name='TrafficCapture',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Capture-Name (auto-generiert)', max_length=100)),
                ('capture_type', models.CharField(choices=[('continuous', 'Continuous Recording'), ('triggered', 'Event Triggered'), ('manual', 'Manual Capture'), ('circuit', 'Circuit Specific')], default='continuous', max_length=20)),
                ('filter_expression', models.CharField(blank=True, help_text='tcpdump/BPF Filter Expression', max_length=500)),
                ('interface', models.CharField(default='eth0', help_text='Capture Interface', max_length=20)),
                ('file_path', models.CharField(help_text='Pfad zur PCAP-Datei', max_length=500)),
                ('file_size_bytes', models.BigIntegerField(default=0, help_text='Dateigröße in Bytes')),
                ('file_hash_sha256', models.CharField(blank=True, help_text='SHA256 Hash der Datei', max_length=64)),
                ('started_at', models.DateTimeField(help_text='Capture-Start')),
                ('stopped_at', models.DateTimeField(blank=True, help_text='Capture-Ende', null=True)),
                ('duration_seconds', models.IntegerField(default=0, help_text='Capture-Dauer in Sekunden')),
                ('packet_count', models.BigIntegerField(default=0, help_text='Anzahl der Pakete')),
                ('bytes_captured', models.BigIntegerField(default=0, help_text='Erfasste Bytes')),
                ('packets_dropped', models.BigIntegerField(default=0, help_text='Verworfene Pakete (Kernel)')),
                ('status', models.CharField(choices=[('recording', 'Recording'), ('completed', 'Completed'), ('analyzing', 'Analyzing...'), ('analyzed', 'Analyzed'), ('error', 'Error'), ('deleted', 'Deleted')], default='recording', max_length=20)),
                ('unique_flows', models.IntegerField(default=0, help_text='Anzahl eindeutiger Flows')),
                ('tor_cells_detected', models.BigIntegerField(default=0, help_text='Erkannte Tor Cells (512 Byte)')),
                ('first_packet_time', models.DateTimeField(blank=True, help_text='Zeitstempel erstes Paket', null=True)),
                ('last_packet_time', models.DateTimeField(blank=True, help_text='Zeitstempel letztes Paket', null=True)),
                ('avg_inter_packet_delay_ms', models.FloatField(blank=True, help_text='Durchschnittliche Inter-Packet Verzögerung', null=True)),
                ('analysis_notes', models.TextField(blank=True, help_text='Analyse-Notizen und Erkenntnisse')),
                ('related_circuit_id', models.CharField(blank=True, help_text='Zugehörige Circuit ID (falls bekannt)', max_length=50)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('node', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='captures', to='chutney.tornode')),
            ],
            options={
                'verbose_name': 'Traffic Capture',
                'verbose_name_plural': 'Traffic Captures',
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='CircuitEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('circuit_id', models.CharField(help_text='Tor Circuit ID', max_length=20)),
                ('event_type', models.CharField(choices=[('launched', 'Circuit Launched'), ('built', 'Circuit Built'), ('extended', 'Circuit Extended'), ('failed', 'Circuit Failed'), ('closed', 'Circuit Closed')], max_length=20)),
                ('purpose', models.CharField(choices=[('general', 'General'), ('hs_client_intro', 'HS Client Intro'), ('hs_client_rend', 'HS Client Rendezvous'), ('hs_service_intro', 'HS Service Intro'), ('hs_service_rend', 'HS Service Rendezvous'), ('testing', 'Testing'), ('controller', 'Controller')], default='general', max_length=30)),
                ('path', models.JSONField(default=list, help_text='Circuit Path (Liste der Hops)')),
                ('path_length', models.IntegerField(default=0, help_text='Anzahl der Hops')),
                ('status', models.CharField(blank=True, help_text='Circuit Status String', max_length=50)),
                ('reason', models.CharField(blank=True, help_text='Grund für FAILED/CLOSED', max_length=100)),
                ('remote_reason', models.CharField(blank=True, help_text='Remote-seitiger Grund', max_length=100)),
                ('event_time', models.DateTimeField(help_text='Zeitpunkt des Events')),
                ('build_time_ms', models.IntegerField(blank=True, help_text='Circuit Build Time in ms (für BUILT events)', null=True)),
                ('raw_event', models.TextField(blank=True, help_text='Rohe Event-Daten von Stem')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('network', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='circuit_events', to='chutney.tornetwork')),
                ('source_node', models.ForeignKey(blank=True, help_text='Node der das Event gemeldet hat', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='circuit_events', to='chutney.tornode')),
            ],
            options={
                'verbose_name': 'Circuit Event',
                'verbose_name_plural': 'Circuit Events',
                'ordering': ['-event_time'],
                'indexes': [models.Index(fields=['network', 'circuit_id'], name='chutney_cir_network_8630e2_idx'), models.Index(fields=['event_time'], name='chutney_cir_event_t_43195f_idx'), models.Index(fields=['event_type'], name='chutney_cir_event_t_75cad6_idx')],
            },
        ),
    ]
