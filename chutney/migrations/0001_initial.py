# Generated by Django 6.0.1 on 2026-01-11 17:31

import django.core.validators
import django.db.models.deletion
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='TorNetwork',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Unique name for this Tor network', max_length=100, unique=True)),
                ('slug', models.SlugField(blank=True, help_text='URL-friendly name (auto-generated)', max_length=100, unique=True)),
                ('description', models.TextField(blank=True, help_text='Description and purpose of this network')),
                ('template', models.CharField(choices=[('minimal', 'Minimal (3 DA, 2 Relay, 1 Exit, 1 Client)'), ('basic', 'Basic (3 DA, 4 Relay, 2 Exit, 2 Client)'), ('standard', 'Standard (3 DA, 6 Relay, 3 Exit, 3 Client)'), ('forensic', 'Forensic (3 DA, 8 Relay, 4 Exit, 4 Client, Full Capture)'), ('custom', 'Custom Configuration')], default='basic', help_text='Network topology template', max_length=20)),
                ('num_directory_authorities', models.PositiveIntegerField(default=3, help_text='Number of Directory Authorities (min. 3 for consensus)', validators=[django.core.validators.MinValueValidator(3), django.core.validators.MaxValueValidator(9)])),
                ('num_guard_relays', models.PositiveIntegerField(default=2, help_text='Number of Guard Relays', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(20)])),
                ('num_middle_relays', models.PositiveIntegerField(default=2, help_text='Number of Middle Relays', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(20)])),
                ('num_exit_relays', models.PositiveIntegerField(default=2, help_text='Number of Exit Relays', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(10)])),
                ('num_clients', models.PositiveIntegerField(default=2, help_text='Number of Tor Clients (SOCKS proxies)', validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(20)])),
                ('num_hidden_services', models.PositiveIntegerField(default=0, help_text='Number of Hidden Service nodes', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(10)])),
                ('docker_network_name', models.CharField(blank=True, help_text='Docker network name (auto-generated)', max_length=100)),
                ('container_prefix', models.CharField(blank=True, help_text='Prefix for container names (auto-generated)', max_length=50)),
                ('base_control_port', models.IntegerField(default=8000, help_text='Base port for Tor Control Ports (8000, 8001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('base_socks_port', models.IntegerField(default=9000, help_text='Base port for SOCKS proxies (9000, 9001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('base_or_port', models.IntegerField(default=5000, help_text='Base port for Onion Router Ports (5000, 5001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('base_dir_port', models.IntegerField(default=7000, help_text='Base port for Directory Ports (7000, 7001, ...)', validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(60000)])),
                ('testing_tor_network', models.BooleanField(default=True, help_text='TestingTorNetwork 1 - Speeds up bootstrap')),
                ('voting_interval', models.IntegerField(default=20, help_text='V3AuthVotingInterval in seconds (lower = faster bootstrap)', validators=[django.core.validators.MinValueValidator(10), django.core.validators.MaxValueValidator(300)])),
                ('assume_reachable', models.BooleanField(default=True, help_text='AssumeReachable 1 - Skips reachability tests')),
                ('capture_enabled', models.BooleanField(default=True, help_text='Enable traffic capture on all nodes')),
                ('capture_filter', models.CharField(blank=True, default='tcp port 5000-5100 or tcp port 9000-9100', help_text='tcpdump filter expression', max_length=200)),
                ('max_capture_size_mb', models.IntegerField(default=100, help_text='Maximum capture size per node in MB', validators=[django.core.validators.MinValueValidator(10), django.core.validators.MaxValueValidator(10000)])),
                ('capture_rotate_interval', models.IntegerField(default=3600, help_text='Capture rotation interval in seconds', validators=[django.core.validators.MinValueValidator(60), django.core.validators.MaxValueValidator(86400)])),
                ('status', models.CharField(choices=[('not_created', 'Not Created'), ('created', 'Created'), ('creating', 'Creating...'), ('bootstrapping', 'Bootstrapping...'), ('running', 'Running'), ('stopping', 'Stopping...'), ('stopped', 'Stopped'), ('error', 'Error')], default='not_created', max_length=20)),
                ('status_message', models.TextField(blank=True, help_text='Detailed status message or error')),
                ('bootstrap_progress', models.IntegerField(default=0, help_text='Bootstrap progress in percent', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('consensus_valid', models.BooleanField(default=False, help_text='Valid consensus available')),
                ('consensus_valid_after', models.DateTimeField(blank=True, help_text='Consensus valid after', null=True)),
                ('consensus_fresh_until', models.DateTimeField(blank=True, help_text='Consensus fresh until', null=True)),
                ('consensus_valid_until', models.DateTimeField(blank=True, help_text='Consensus valid until', null=True)),
                ('total_circuits_created', models.PositiveIntegerField(default=0)),
                ('total_bytes_transferred', models.BigIntegerField(default=0)),
                ('total_cells_processed', models.BigIntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('stopped_at', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'verbose_name': 'Tor Network',
                'verbose_name_plural': 'Tor Networks',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='TorNode',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Node name (e.g. da1, guard1, exit2)', max_length=100)),
                ('node_type', models.CharField(choices=[('da', 'Directory Authority'), ('guard', 'Guard Relay'), ('middle', 'Middle Relay'), ('exit', 'Exit Relay'), ('client', 'Client (SOCKS Proxy)'), ('hs', 'Hidden Service')], help_text='Type of Tor node', max_length=10)),
                ('index', models.PositiveIntegerField(default=0, help_text='Index within the type (0, 1, 2, ...)')),
                ('container_id', models.CharField(blank=True, help_text='Docker Container ID', max_length=64)),
                ('container_name', models.CharField(blank=True, help_text='Docker Container Name', max_length=100)),
                ('control_port', models.IntegerField(blank=True, help_text='Tor Control Port', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('socks_port', models.IntegerField(blank=True, help_text='SOCKS5 Proxy Port (clients only)', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('or_port', models.IntegerField(blank=True, help_text='Onion Router Port', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('dir_port', models.IntegerField(blank=True, help_text='Directory Port (DAs only)', null=True, validators=[django.core.validators.MinValueValidator(1024), django.core.validators.MaxValueValidator(65535)])),
                ('fingerprint', models.CharField(blank=True, help_text='Relay Fingerprint (40 hex chars)', max_length=50)),
                ('v3_identity', models.CharField(blank=True, help_text='V3 Authority Identity (DAs only)', max_length=50)),
                ('nickname', models.CharField(blank=True, help_text='Tor Relay Nickname', max_length=50)),
                ('onion_address', models.CharField(blank=True, help_text='.onion address (Hidden Services only)', max_length=62)),
                ('hs_port', models.IntegerField(blank=True, help_text='Hidden Service virtual port', null=True)),
                ('hs_target_port', models.IntegerField(blank=True, help_text='Hidden Service target port (localhost)', null=True)),
                ('flags', models.JSONField(blank=True, default=list, help_text='Relay flags from consensus')),
                ('status', models.CharField(choices=[('not_created', 'Not Created'), ('created', 'Created'), ('starting', 'Starting...'), ('bootstrapping', 'Bootstrapping...'), ('running', 'Running'), ('stopping', 'Stopping...'), ('stopped', 'Stopped'), ('error', 'Error')], default='not_created', max_length=20)),
                ('status_message', models.TextField(blank=True, help_text='Detailed status message')),
                ('bootstrap_progress', models.IntegerField(default=0, help_text='Bootstrap progress in percent', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('capture_enabled', models.BooleanField(default=True, help_text='Traffic capture enabled for this node')),
                ('capture_interface', models.CharField(default='eth0', help_text='Network interface for capture', max_length=20)),
                ('capture_file_path', models.CharField(blank=True, help_text='Path to current capture file', max_length=255)),
                ('bytes_read', models.BigIntegerField(default=0, help_text='Bytes received')),
                ('bytes_written', models.BigIntegerField(default=0, help_text='Bytes sent')),
                ('circuits_created', models.PositiveIntegerField(default=0, help_text='Circuits created')),
                ('circuits_active', models.PositiveIntegerField(default=0, help_text='Active circuits')),
                ('bandwidth_rate', models.BigIntegerField(default=0, help_text='Current bandwidth (bytes/s)')),
                ('bandwidth_burst', models.BigIntegerField(default=0, help_text='Burst bandwidth (bytes/s)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('started_at', models.DateTimeField(blank=True, null=True)),
                ('last_seen', models.DateTimeField(blank=True, null=True)),
                ('network', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='nodes', to='chutney.tornetwork')),
            ],
            options={
                'verbose_name': 'Tor Node',
                'verbose_name_plural': 'Tor Nodes',
                'ordering': ['network', 'node_type', 'index'],
                'unique_together': {('network', 'name')},
            },
        ),
        migrations.CreateModel(
            name='TrafficCapture',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Capture name (auto-generated)', max_length=100)),
                ('capture_type', models.CharField(choices=[('continuous', 'Continuous Recording'), ('triggered', 'Event Triggered'), ('manual', 'Manual Capture'), ('circuit', 'Circuit Specific')], default='continuous', max_length=20)),
                ('filter_expression', models.CharField(blank=True, help_text='tcpdump/BPF filter expression', max_length=500)),
                ('interface', models.CharField(default='eth0', help_text='Capture interface', max_length=20)),
                ('file_path', models.CharField(help_text='Path to PCAP file', max_length=500)),
                ('file_size_bytes', models.BigIntegerField(default=0, help_text='File size in bytes')),
                ('file_hash_sha256', models.CharField(blank=True, help_text='SHA256 hash of file', max_length=64)),
                ('started_at', models.DateTimeField(help_text='Capture start')),
                ('stopped_at', models.DateTimeField(blank=True, help_text='Capture end', null=True)),
                ('duration_seconds', models.IntegerField(default=0, help_text='Capture duration in seconds')),
                ('packet_count', models.BigIntegerField(default=0, help_text='Number of packets')),
                ('bytes_captured', models.BigIntegerField(default=0, help_text='Captured bytes')),
                ('packets_dropped', models.BigIntegerField(default=0, help_text='Dropped packets (kernel)')),
                ('status', models.CharField(choices=[('recording', 'Recording'), ('completed', 'Completed'), ('analyzing', 'Analyzing...'), ('analyzed', 'Analyzed'), ('error', 'Error'), ('deleted', 'Deleted')], default='recording', max_length=20)),
                ('unique_flows', models.IntegerField(default=0, help_text='Number of unique flows')),
                ('tor_cells_detected', models.BigIntegerField(default=0, help_text='Detected Tor cells (512 bytes)')),
                ('first_packet_time', models.DateTimeField(blank=True, help_text='Timestamp of first packet', null=True)),
                ('last_packet_time', models.DateTimeField(blank=True, help_text='Timestamp of last packet', null=True)),
                ('avg_inter_packet_delay_ms', models.FloatField(blank=True, help_text='Average inter-packet delay', null=True)),
                ('analysis_notes', models.TextField(blank=True, help_text='Analysis notes and findings')),
                ('related_circuit_id', models.CharField(blank=True, help_text='Related Circuit ID (if known)', max_length=50)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('node', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='captures', to='chutney.tornode')),
            ],
            options={
                'verbose_name': 'Traffic Capture',
                'verbose_name_plural': 'Traffic Captures',
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='CircuitEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('circuit_id', models.CharField(help_text='Tor Circuit ID', max_length=20)),
                ('event_type', models.CharField(choices=[('launched', 'Circuit Launched'), ('built', 'Circuit Built'), ('extended', 'Circuit Extended'), ('failed', 'Circuit Failed'), ('closed', 'Circuit Closed')], max_length=20)),
                ('purpose', models.CharField(choices=[('general', 'General'), ('hs_client_intro', 'HS Client Intro'), ('hs_client_rend', 'HS Client Rendezvous'), ('hs_service_intro', 'HS Service Intro'), ('hs_service_rend', 'HS Service Rendezvous'), ('testing', 'Testing'), ('controller', 'Controller')], default='general', max_length=30)),
                ('path', models.JSONField(default=list, help_text='Circuit path (list of hops)')),
                ('path_length', models.IntegerField(default=0, help_text='Number of hops')),
                ('status', models.CharField(blank=True, help_text='Circuit status string', max_length=50)),
                ('reason', models.CharField(blank=True, help_text='Reason for FAILED/CLOSED', max_length=100)),
                ('remote_reason', models.CharField(blank=True, help_text='Remote-side reason', max_length=100)),
                ('event_time', models.DateTimeField(help_text='Event timestamp')),
                ('build_time_ms', models.IntegerField(blank=True, help_text='Circuit build time in ms (for BUILT events)', null=True)),
                ('raw_event', models.TextField(blank=True, help_text='Raw event data from Stem')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('network', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='circuit_events', to='chutney.tornetwork')),
                ('source_node', models.ForeignKey(blank=True, help_text='Node that reported the event', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='circuit_events', to='chutney.tornode')),
            ],
            options={
                'verbose_name': 'Circuit Event',
                'verbose_name_plural': 'Circuit Events',
                'ordering': ['-event_time'],
                'indexes': [models.Index(fields=['network', 'circuit_id'], name='chutney_cir_network_8630e2_idx'), models.Index(fields=['event_time'], name='chutney_cir_event_t_43195f_idx'), models.Index(fields=['event_type'], name='chutney_cir_event_t_75cad6_idx')],
            },
        ),
    ]
